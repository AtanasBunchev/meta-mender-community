From be0c3fe9a35106f68ed706ecbe86e609499a7f8e Mon Sep 17 00:00:00 2001
From: Chris Dimich <Chris.Dimich@boundarydevices.com>
Date: Mon, 25 Jan 2021 16:11:14 -0800
Subject: [PATCH 1/3] nitrogen8m: add Mender support

Signed-off-by: Chris Dimich <Chris.Dimich@boundarydevices.com>
---
 configs/nitrogen8m_defconfig | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/configs/nitrogen8m_defconfig b/configs/nitrogen8m_defconfig
index b8a4d3756c..490f8c5eb8 100644
--- a/configs/nitrogen8m_defconfig
+++ b/configs/nitrogen8m_defconfig
@@ -9,7 +9,7 @@ CONFIG_SPL_LIBGENERIC_SUPPORT=y
 CONFIG_SYS_MALLOC_F_LEN=0x5000
 CONFIG_NR_DRAM_BANKS=1
 CONFIG_ENV_SIZE=0x2000
-CONFIG_ENV_OFFSET=0xffffe000
+CONFIG_ENV_OFFSET=0x800000
 # CONFIG_SPLASH_SCREEN_PREPARE is not set
 CONFIG_SYS_I2C_MXC_I2C1=y
 CONFIG_SYS_I2C_MXC_I2C2=y
@@ -81,9 +81,11 @@ CONFIG_SPL_OF_CONTROL=y
 CONFIG_ENV_OVERWRITE=y
 CONFIG_ENV_IS_IN_MMC=y
 CONFIG_SYS_RELOC_GD_ENV_ADDR=y
-CONFIG_SYS_MMC_ENV_PART=1
+CONFIG_SYS_MMC_ENV_PART=0
 CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y
 CONFIG_NET_RANDOM_ETHADDR=y
+CONFIG_BOOTCOUNT_LIMIT=y
+CONFIG_BOOTCOUNT_ENV=y
 CONFIG_IMX8M_LPDDR4=y
 CONFIG_USB_FUNCTION_FASTBOOT=y
 CONFIG_FASTBOOT_BUF_ADDR=0x40480000
@@ -139,3 +141,6 @@ CONFIG_SPLASH_SCREEN=y
 CONFIG_SPLASH_SCREEN_ALIGN=y
 CONFIG_IMX_WATCHDOG=y
 CONFIG_LIBAVB=y
+CONFIG_ENV_OFFSET=0x800000
+CONFIG_ENV_OFFSET_REDUND=0x1000000
+CONFIG_SYS_REDUNDAND_ENVIRONMENT=y
-- 
2.29.0


From e1a525f9d8f4c362a6ddf34c59b1bea835700173 Mon Sep 17 00:00:00 2001
From: Chris Dimich <Chris.Dimich@boundarydevices.com>
Date: Mon, 25 Jan 2021 16:11:31 -0800
Subject: [PATCH 2/3] nitrogen8mm_2g: add Mender support

Signed-off-by: Chris Dimich <Chris.Dimich@boundarydevices.com>
---
 configs/nitrogen8mm_2g_defconfig | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/configs/nitrogen8mm_2g_defconfig b/configs/nitrogen8mm_2g_defconfig
index aa84f4b260..6e2a585681 100644
--- a/configs/nitrogen8mm_2g_defconfig
+++ b/configs/nitrogen8mm_2g_defconfig
@@ -9,7 +9,7 @@ CONFIG_SPL_LIBGENERIC_SUPPORT=y
 CONFIG_SYS_MALLOC_F_LEN=0x10000
 CONFIG_NR_DRAM_BANKS=1
 CONFIG_ENV_SIZE=0x2000
-CONFIG_ENV_OFFSET=0xffffe000
+CONFIG_ENV_OFFSET=0x800000
 CONFIG_SYS_I2C_MXC_I2C1=y
 CONFIG_SYS_I2C_MXC_I2C2=y
 CONFIG_SYS_I2C_MXC_I2C3=y
@@ -78,9 +78,11 @@ CONFIG_SPL_OF_CONTROL=y
 CONFIG_ENV_OVERWRITE=y
 CONFIG_ENV_IS_IN_MMC=y
 CONFIG_SYS_RELOC_GD_ENV_ADDR=y
-CONFIG_SYS_MMC_ENV_PART=1
+CONFIG_SYS_MMC_ENV_PART=0
 CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y
 CONFIG_NET_RANDOM_ETHADDR=y
+CONFIG_BOOTCOUNT_LIMIT=y
+CONFIG_BOOTCOUNT_ENV=y
 CONFIG_NETCONSOLE=y
 CONFIG_SPL_DM=y
 CONFIG_SPL_CLK_COMPOSITE_CCF=y
@@ -140,3 +142,6 @@ CONFIG_USBNET_HOST_ADDR="00:19:b8:00:00:01"
 CONFIG_USB_HOST_ETHER=y
 CONFIG_IMX_WATCHDOG=y
 CONFIG_LIBAVB=y
+CONFIG_ENV_OFFSET=0x800000
+CONFIG_ENV_OFFSET_REDUND=0x1000000
+CONFIG_SYS_REDUNDAND_ENVIRONMENT=y
-- 
2.29.0


From f5fb2c6a4ee8b4a4116986416ee9d5ca25235d02 Mon Sep 17 00:00:00 2001
From: Chris Dimich <Chris.Dimich@boundarydevices.com>
Date: Mon, 25 Jan 2021 16:11:48 -0800
Subject: [PATCH 3/3] nitrogen8mm_rev2_2g: add Mender support

Signed-off-by: Chris Dimich <Chris.Dimich@boundarydevices.com>
---
 configs/nitrogen8mm_rev2_2g_defconfig | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/configs/nitrogen8mm_rev2_2g_defconfig b/configs/nitrogen8mm_rev2_2g_defconfig
index af61ddf7d0..923adf1e16 100644
--- a/configs/nitrogen8mm_rev2_2g_defconfig
+++ b/configs/nitrogen8mm_rev2_2g_defconfig
@@ -9,7 +9,7 @@ CONFIG_SPL_LIBGENERIC_SUPPORT=y
 CONFIG_SYS_MALLOC_F_LEN=0x10000
 CONFIG_NR_DRAM_BANKS=1
 CONFIG_ENV_SIZE=0x2000
-CONFIG_ENV_OFFSET=0xffffe000
+CONFIG_ENV_OFFSET=0x800000
 CONFIG_SYS_I2C_MXC_I2C1=y
 CONFIG_SYS_I2C_MXC_I2C2=y
 CONFIG_SYS_I2C_MXC_I2C3=y
@@ -79,9 +79,11 @@ CONFIG_SPL_OF_CONTROL=y
 CONFIG_ENV_OVERWRITE=y
 CONFIG_ENV_IS_IN_MMC=y
 CONFIG_SYS_RELOC_GD_ENV_ADDR=y
-CONFIG_SYS_MMC_ENV_PART=1
+CONFIG_SYS_MMC_ENV_PART=0
 CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y
 CONFIG_NET_RANDOM_ETHADDR=y
+CONFIG_BOOTCOUNT_LIMIT=y
+CONFIG_BOOTCOUNT_ENV=y
 CONFIG_NETCONSOLE=y
 CONFIG_SPL_DM=y
 CONFIG_SPL_CLK_COMPOSITE_CCF=y
@@ -141,3 +143,6 @@ CONFIG_USBNET_HOST_ADDR="00:19:b8:00:00:01"
 CONFIG_USB_HOST_ETHER=y
 CONFIG_IMX_WATCHDOG=y
 CONFIG_LIBAVB=y
+CONFIG_ENV_OFFSET=0x800000
+CONFIG_ENV_OFFSET_REDUND=0x1000000
+CONFIG_SYS_REDUNDAND_ENVIRONMENT=y
-- 
2.29.0

